
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>2015年我都干嘛了 - Handy's</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="2015年即将结束，那这一年我到底都干嘛了？ 从去年(2014)的12月份就开始暗无天日的加班忙碌，直到今天下半年才好了很多，眼看这就要要2016了，
也该回顾一下2015年的工作了。 AutoLayout 2015年12月，加入了一个新团队－嗨购，仍然是负责iOS项目开发，人员上加上我两人， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Handy-Wang.github.io/blog/2015/12/06/2015nian-wo-du-gan-ma-liao">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Handy's" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Handy's</a></h1>
  
    <h2>Stay hungry, stay foolish.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="Handy-Wang.github.io" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">2015年我都干嘛了</h1>
      
    
    
      <p class="meta">
        





        
        
      </p>
    
  </header>


<div class="entry-content"><p>2015年即将结束，那这一年我到底都干嘛了？</p>

<pre><code>从去年(2014)的12月份就开始暗无天日的加班忙碌，直到今天下半年才好了很多，眼看这就要要2016了，
也该回顾一下2015年的工作了。
</code></pre>

<h4>AutoLayout</h4>

<p>2015年12月，加入了一个新团队－嗨购，仍然是负责iOS项目开发，人员上加上我两人，版本处于0.0.1版本。</p>

<p>当时接收项目后，发现这个项目的界面采用storyboard+autolayout开发，另外那个哥们去AutoLayout的使用也处于学习阶段，所以遇到的主要问题就是修改界面的Bug。由于我之前没有使用过storyboard和autolayout，再加上UI设计师对界面的细节控制要求很高，所以有些应付不了了。在另一个哥们儿的辅助下，将就着开发了0.1.0版本(仍采用storyboard+autolayout)，其实这个过程非常苦恼，“是好好学习一下AutoLayout，然后在项目里继续使用AutoLayout呢？” 还是 “采用自己熟悉的纯代码方式来编写？”</p>

<!--more-->


<p>最后，综合考虑项目的进度压力、质量的可控性、学习的时间成本后，决定还是暂时放弃Storyboard+AutoLayout，转而使用保守的纯代码方式开发。</p>

<p>在0.1.0版本后，恰逢元旦，另外那个哥们儿休假半个月左右，回家结婚去了。我就逮着这个时机，在项目0.2.0时把项目界面实现方式、网络层、数据库等进行了大重构。</p>

<p>现在相对不忙碌了，计划补补 Todo: <a href="https://developer.apple.com/library/mac/documentation/UserExperience/Conceptual/AutolayoutPG/index.html">AutoLayout</a>以及 Todo: <a href="https://github.com/SnapKit/Masonry">Masonry</a>.</p>

<h4>CocoaPods</h4>

<p>其实，上面提到AutoLayout被我弃用后，就感觉比较反人类了，然后我仍然还要反人类一次。</p>

<p>嗨购项目在0.2.0及之前，对第三方库的依赖方式是通过CocoaPods来管理的，但是为什么这之后我把CocoaPods去掉了呢？这就不得不提到Jenkins(我会在后面聊聊Jenkins)和CocoaPods的代码管理。</p>

<p>本来采用Jenkins对iOS项目打包发布是一件很NB的事情，但是对通过CocoaPods管理第三库的iOS项目打包是一件非常痛苦的事情。说起痛苦，主要是集中在Jenkins上的配置以及项目本身的一些配置，如：Jenkins里build目录的指定、项目中schema的share等问题。这一系列问题我都有记录，这里就不细说了。虽然痛若，但是经过两三天的努力，可以通过Jenkins打包CocoaPods管理的项目。</p>

<p>感觉这一点还好，但是，没有想到最后让我放弃CocoaPods的原因尽是它的优点：无感知管理项目的第三方库依赖。
因为，</p>

<ol>
<li>第三方库难免有Bug，所以我也经常修改这些源码里Bug，修改地方多了后也就忘了修改过哪些地方了。然后有一天我pod update了一下，如果本地的源码修改没有了，我得从项目的SVN上对比着再被回来，当时非常恼怒。。。</li>
<li>由于天国的各种墙，安装cocoapods时我修改了gem源为<a href="https://rubygems.org/">https://rubygems.org/</a> . 但是，没有想到在某几天pod update和pod install根本用不了，导致严重影响了我预期的开发进度。</li>
</ol>


<p>所以，我又选择了保守的方案，删除cocoapods，转而采用源代码依赖的方式，这样一来Jenkins打包也简化了。</p>

<pre><code>现在回想，关于那段配置Jenkins打包CocoaPods项目的经历非常可贵，那是对意志的磨砺。
</code></pre>

<ul>
<li><strong>相关知识</strong></li>
<li><a href="https://www.evernote.com/l/AFkw93ypG4JB9Ka-cwCPgU-xtTWZx9RTEa4">Jenkins打包CocoaPods项目</a></li>
<li><a href="http://blog.devtang.com/blog/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/">更换CocoaPods的镜像</a></li>
</ul>


<h4>Jenkins</h4>

<p>刚到嗨购的时候，发布安装包的方式是archive ipa文件并上传到fir.im进行发布，以供其它人员进行安装试用或测试。随着项目的推进，期望把这种Inhouse Release的方式自动化，所以引入之前在搜狐时就一直采用的Jenkins进行自动打包发布。</p>

<p>关于Jenkins的安装我简要提一下，主要还是回顾一下使用过程中遇到的问题</p>

<p><strong>Jenkins环境</strong></p>

<ul>
<li>下载Jenkins.war，然后启动java -jar jenkins.war</li>
<li>Jenkins的相关目录

<ul>
<li>/Applications/Jenkins &ndash; which is having the jenkins.war alone.</li>
<li>/Users/Shared/Jenkins &ndash; with all the plugins, war, jobs, usercontent, etc.</li>
<li>/Users/Shared/Jenkins/Home &ndash; JENKINS_HOME</li>
<li>/Library/LaunchDaemons/org.jenkins-ci.plist &ndash; Jenkins自启动文件</li>
<li>/Library/Application Support/Jenkins/jenkins-runner.sh &ndash; 自启动shell脚本</li>
</ul>
</li>
</ul>


<p><strong>Jenkins+CocoaPods项目</strong></p>

<ul>
<li>参见<a href="https://www.evernote.com/l/AFkw93ypG4JB9Ka-cwCPgU-xtTWZx9RTEa4">我的Evenote Sharing</a></li>
</ul>


<p><strong>七牛空间</strong></p>

<ul>
<li>参见<a href="https://www.evernote.com/l/AFkw93ypG4JB9Ka-cwCPgU-xtTWZx9RTEa4">我的Evenote Sharing</a></li>
</ul>


<p><strong>打包状态邮件通知</strong></p>

<ul>
<li>在Jenkins里安装Mail Notification Plugin</li>
<li>以126邮件为例，配置SMPT服务器及端口</li>
<li>注意：Jenkins管理员邮箱要与发送邮件的账号一致，不然会发送邮件失败。</li>
<li>在具体项目中，可以配置相应的收件人、trigger等。</li>
</ul>


<h4>Redmine</h4>

<p>在2008年刚参加工作的时候，老东家就有搭建Redmine用于项目管理、issue跟踪、Wiki书写。在搜狐的时候，是由服务器同学搭建的trac来写wiki。由于刚到嗨购团队的时候，接口文件都是服务器同学通过word文档来记录并分发给相关开发人员。我觉得这样非常的不方便，不但不方便更改，也不便于分发。所以，我偷摸地在公司内网搭建了Redmine，给相关技术人员分发了账号和权限，从而以后<strong>“妈妈再也不用担心我们的接口文档了”</strong>。</p>

<pre><code>Todo: 也有朋友在git上写项目的wiki，改天一定要试下
</code></pre>

<p>到目前为止，我采用过三种搭建Redmine的方法：</p>

<ol>
<li>纯手工24K金方式打造Apache+MySQL+ROR

<ul>
<li>完全手工地安装Apache、MySQL、RubyOnRails环境</li>
<li>此法太虐心，会遇到各种东西没有安装，非常煎熬</li>
</ul>
</li>
<li>采用BitNami一键式安装Redmine

<ul>
<li>采用BitNami安装的Redmine，在一个单独的目录下安装了Apache、MySQL等环境。</li>
<li>BitNami安装Redmine后，操作系统里安装的Apache、MySQL的环境变量被修改了</li>
<li>为了安装一个Redmine，把操作系统里本身配置的一些环境变量给搞乱，不好不好。</li>
</ul>
</li>
<li>布署Redmine项目源码

<ul>
<li>Redmine本身是一个ROR项目，再加上09年左右的时候做过一个ROR项目，所以此法可试。</li>
<li>下载Redmine源码: <a href="http://www.redmine.org/projects/redmine/wiki/Download">http://www.redmine.org/projects/redmine/wiki/Download</a></li>
<li>解压Redmine到某个目录</li>
<li>配置数据库连接，并创建或导入Redmine数据库表</li>
<li>在Redmine项目运行sudo ruby bin/rails server webrick -e production来启动项目，从而抛弃Apache</li>
<li><strong>此法最好，对于我来说最简单直接，也符合程序思维(建立数据库、配置数据连接、部署项目源码并运行)</strong></li>
</ul>
</li>
</ol>


<h4>Push Notification Simulator</h4>

<p>早在搜狐的时候，就遇到推送调试非常不方便的问题。试用了一些方案，但最终于我还是搭建了一套更好的方案，并运用到了搜狐新闻和嗨购项目中。</p>

<p>最开始的方案是采用PushMeBaby，这是一个Mac版的源代码项目，把项目需要收到推送的Dev或Release的push certification导入项目，并设置好相应的宏就可以运行一个Mac App，然后输入相应手机的Token就可以发推送了。</p>

<p>随着我对PushMeBaby的使用，非常想把推送模拟发送机制进行改进，因为我发现它有几个弊端：</p>

<ul>
<li>PushMeBaby的环境建立不方便，因为它是一个Mac环境，需要在开发人员自己的电脑各位持有一位源码并运行。完全没有必要。</li>
<li>PushMeBaby需要配置Push Certificate，这一点估计会难倒不少对iOS开发的PrivateKey、Certificate、Provisioning Profile等授权概念比较混淆的人。门槛有点高。</li>
<li>PushMeBaby只能给某一个PushCertificate发推送。非常不灵活。</li>
<li>PushMeBaby只能输入Token。非常不灵活。</li>
<li>PushMeBaby的推送内容修改只能修改源码。非常不方便。</li>
</ul>


<p>终于，在开发搜狐新闻的<strong>推送打开Navtive页面</strong>这一功能时，由于要反复调试推送内容，所以我决定自己搭一个即保留PushMeBaby已有功能，也可以解决以上问题的推送环境，我给它起了个名字－Push Notification Simulator。</p>

<p><strong>Push Notification Simulator</strong></p>

<ul>
<li>找一台做CI的服务器(肯定是Mac嘛)</li>
<li>Mac自带Apache+PHP环境。大环境就这么轻松的满足了。</li>
<li>开发一个简单的H5页面作为首页

<ul>
<li>具备推送内容的配置功能</li>
<li>具备Push Certificate的选择功能，只需要由一人来上传各Push Certificate即可。</li>
<li>具备Token的选择和手动输入功能</li>
</ul>
</li>
<li>开发一个可以把H5页可编辑内容作为参数来发送推送的PHP文件</li>
<li>运行，测试，好使。</li>
</ul>


<p>在一个团队里，这是一个非常省心的方案。</p>

<h4>Crashlytics &amp; App Log</h4>

<p>App crash给人一种非常重大的事件的感觉，所以早期遇到App crash总是有些菊花一紧的感觉。倒不是说害怕App crash，而是因为环境的限制或者低概念crash而查不到App crash的原因，尤其是在线上版本crash的时候。</p>

<p>目前，友盟、TalkingData等第三方统计平台也都可以借助其SDK上报Crash Log了，但毕竟它们的核心是做统计，其实Crash Log分析远远比不上Crashlytics.</p>

<p><strong>Crashlytics</strong></p>

<p>最开始，Crashlytics作为一个独立项目存在，后被Twitter收购作为Fabric下的一个子项目了。</p>

<p>现在，集成Crashlytics挺方便的：</p>

<ul>
<li>注册 Fabric 账号</li>
<li>安装 Fabric 客户端</li>
<li>按 Fabric 客户端的指引导入 Fabric 和 Crashlitics Framework</li>
<li>在 AppDelegate 中 import Crashlytics，并初始化 SDK</li>
<li>添加 RunScript。我会判断不是 Debug Configuration 时才上报 Crash Log。Debug Configuration 下的crash 一般都好解决，因为这时还处于开发环境；而 Release 或 Release-Inhouse 已处于 Distribution 环境了。</li>
</ul>


<p>在 Crashlytics 网站后台可以很方便的分App、分版本的查看不同时间段的 Crash Log，并且还可以在 App 内使用Crashlytics 来输出特定的日志或标记，以便在Crashlytics 网站后台查看 Crash Log 时可以更好的跟踪 Crash 原因。</p>

<p><strong>App Log</strong></p>

<p>Crashlytics偏技术，重点在于解决Crash。</p>

<p>但是，App发版以后，可能仍存在一些逻辑漏洞没有被测试出来，比如页面上的数据展现效果很奇怪、页面间某些衔接逻辑有些混乱了，类似的这一类问题属于业务问题。当在App发版后，发生业务Bug且开发人员很难通过Review自己的代码来查找Bug时，就需要借助服务器日志或App日志。</p>

<p>我在嗨购项目里尝试写一个上传代码日志的逻辑，原理很简单：</p>

<ul>
<li>把App内的NSLog输出的日志重定向输出到一个文件并保存起来</li>
<li>每次App EnterBackground时，启动一个BackgroundTask线程检查日志文件是否大于1M了，如果大于1M则上传到服务器，上传成功则删除日志文件</li>
<li>此日志文件不纳入App缓存管理的范畴</li>
</ul>


<p>另看，这一小小的机制，在后来辅助修改业务Bug起到了在作用。</p>

<pre><code>Crashlytics &amp; App Log已作为我经手的项目的常规架构支持。
</code></pre>

<h4>嗨购项目架构演进概要</h4>

<p>Todo:</p>
</div>


  <footer>
    <p class="meta">
      
  



  <span class="byline author vcard">Authored by <span class="fn">
  
    Your Name
  
  </span></span>


      





      
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://Handy-Wang.github.io/blog/2015/12/06/2015nian-wo-du-gan-ma-liao/" data-via="" data-counturl="http://Handy-Wang.github.io/blog/2015/12/06/2015nian-wo-du-gan-ma-liao/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/03/27/ru-he-zhong-zhi-tui-song-she-zhi-ti-xing/" title="Previous Post: 如何重置推送设置提醒(转)">&laquo; 如何重置推送设置提醒(转)</a>
      
      
    </p>
  </footer>
</article>


</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
